name: üîÅ Sync Org to Personal Repo (Fresh Push)

on:
  push:
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: ‚¨áÔ∏è Checkout org repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history for proper sync

      - name: üîß Configure Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: üîç Debug GH_PAT presence
        run: echo "GH_PAT is ${{ secrets.GH_PAT && 'set' || 'not set' }}"

      - name: üöÄ Push to personal repo (Benjy0812/Gooble)
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
        run: |
          # Remove any existing origin and add personal repo as new remote
          git remote remove origin || true
          git remote add personal https://Benjy0812:${GH_PAT}@github.com/Benjy0812/Gooble.git
          
          # Ensure we're on main branch
          git checkout -B main
          
          # Push with retry logic
          for i in 1 2 3; do
            echo "Attempt $i to push..."
            if git push personal main --force; then
              echo "‚úÖ Successfully pushed to personal repo!"
              break
            else
              echo "‚ùå Push failed on attempt $i"
              if [ $i -eq 3 ]; then
                echo "üö® All push attempts failed!"
                exit 1
              fi
              echo "‚è≥ Retrying in 5 seconds..."
              sleep 5
            fi
          done